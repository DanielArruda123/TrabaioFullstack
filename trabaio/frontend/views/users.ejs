<h1>
  <%= title %>
</h1>

<form id="userForm" action="">
  <input type="hidden" id="id">

  <label for="username">Nome</label>
  <input name="username" id="username" type="text"><br>

  <label for="password">Senha</label>
  <input name="password" id="password" type="password"><br>

  <label for="email">Email</label>
  <input name="email" id="email" type="email"><br>

  <label for="phone">Telefone</label>
  <input name="phone" id="phone" type="tel"><br>

  <button type="submit">Enviar</button>
  <button type="reset">Cancelar</button>
</form>

<span id="error"></span>

<% if (error) { %>
  <span><%= error %></span>
<% } %>

<table>
  <thead>
    <tr>
      <% for(let col of cols) { %>
        <th><%= col %></th>
      <% } %>
    </tr>
  </thead>
  <tbody>
    <% if (users && users.length > 0) { %>
      <% users.forEach(user => { %>
        <tr>
          <td><%= user.username %></td>
          <td><%= user.password %></td>
          <td><%= user.email %></td>
          <td><%= user.phone %></td>
          <td>
            <button>Editar</button>
            <button>Excluir</button>
          </td>
        </tr>
      <% }); %>
    <% } else { %>
      <tr><td colspan="<%= cols.length %>">Nenhum usu√°rio encontrado.</td></tr>
    <% } %>
  </tbody>
</table>

<script>
  const form = document.getElementById('userForm')

  form.addEventListener("submit", (e) => {
    e.preventDefault()

    const formData = new FormData(form)
    const user = {}
    formData.forEach((v, k) => {
      user[k] = v
    })

    fetch("/users", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(user)
    })
      .then((res) => res.json())
      .then((user) => {
        console.log('foi salvo', user)
      })
      .catch((error) => {
        document.getElementById('error').innerText = error.message || "Erro ao salvar"
      })
  })
</script>
